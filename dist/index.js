"use strict";var f=Object.defineProperty;var $=Object.getOwnPropertyDescriptor;var N=Object.getOwnPropertyNames;var y=Object.prototype.hasOwnProperty;var D=(e,o)=>{for(var t in o)f(e,t,{get:o[t],enumerable:!0})},h=(e,o,t,d)=>{if(o&&typeof o=="object"||typeof o=="function")for(let n of N(o))!y.call(e,n)&&n!==t&&f(e,n,{get:()=>o[n],enumerable:!(d=$(o,n))||d.enumerable});return e};var S=e=>h(f({},"__esModule",{value:!0}),e);var g=(e,o,t)=>new Promise((d,n)=>{var a=r=>{try{i(t.next(r))}catch(u){n(u)}},s=r=>{try{i(t.throw(r))}catch(u){n(u)}},i=r=>r.done?d(r.value):Promise.resolve(r.value).then(a,s);i((t=t.apply(e,o)).next())});var W={};D(W,{activate:()=>J,config:()=>O});module.exports=S(W);var c="workspace-default-notebook",p=`${c}`,l=`${c}`,m=()=>{var i;let{sidebar:{workspace:e},queryContext:o,bookList:t}=inkdrop.store.getState(),d=o.mode==="book"&&o.bookId||void 0,n=e.visible?e.bookId:void 0,a=n!==void 0&&n===d,s=(i=t.bookForContextMenu)==null?void 0:i._id;return{selectedBookId:d,workspaceBookId:n,workspaceRootSelected:a,menuTargetBookId:s}},B=(e,o)=>{let t=JSON.parse(inkdrop.config.get(`${l}.defaults`));t[e]=o,inkdrop.config.set(`${l}.defaults`,JSON.stringify(t))},w=e=>JSON.parse(inkdrop.config.get(`${l}.defaults`))[e],v=e=>g(void 0,null,function*(){if(e===void 0){inkdrop.commands.dispatch(document.body,"core:new-note");return}let o=inkdrop.main.dataStore.getLocalDB(),t={_id:o.notes.createId(),_rev:void 0,body:"",title:"",doctype:"markdown",createdAt:+new Date,updatedAt:+new Date,pinned:!1,bookId:e};try{yield o.notes.put(t);let d=t._id;inkdrop.commands.dispatch(document.body,"core:open-note",{noteId:d}),inkdrop.commands.dispatch(document.body,"editor:focus-mde")}catch(d){console.error(`[${c}] error while creating note: `,d),inkdrop.notifications.addError("Failed to create new note",{dismissable:!0,detail:`error: ${d}`})}}),x=()=>{let{workspaceBookId:e,workspaceRootSelected:o}=m(),t=o&&e?w(e):void 0;console.debug(`[${c}] creating new note`),v(t)},T=()=>{var t,d;let{menuTargetBookId:e,workspaceBookId:o}=m();if(o!==void 0&&e!==void 0){console.debug(`[${c}] marking ${e} as default notebook of ${o}`),B(o,e),b();let{books:n}=inkdrop.store.getState(),a=((t=n.hash[e])==null?void 0:t.name)||"",s=((d=n.hash[o])==null?void 0:d.name)||"";inkdrop.notifications.addInfo("Workspace default notebook updated",{dismissable:!0,detail:`Default notebook for "${s}" is set to "${a}"`})}},k,I,_=".sidebar-workspace-menu .sidebar-menu-item-all-notes",b=()=>{var s;k!==void 0&&(k.dispose(),k=void 0);let{workspaceBookId:e}=m(),{books:o}=inkdrop.store.getState(),t=e?w(e):void 0,n=`Default: ${t&&((s=o.hash[t])==null?void 0:s.name)||"(none)"}`,a=`${p}:void`;k=inkdrop.contextMenu.add({[_]:[{label:n,command:a}]}),I=e},J=()=>{inkdrop.commands.add(document.body,`${p}:new-note`,x),inkdrop.commands.add(document.body,`${p}:set-default`,T),inkdrop.store.subscribe(()=>{let{sidebar:{workspace:e}}=inkdrop.store.getState();e.visible&&e.bookId!==I&&b()}),b()},O={defaults:{title:"default notebooks",type:"string",default:"{}"}};0&&(module.exports={activate,config});
